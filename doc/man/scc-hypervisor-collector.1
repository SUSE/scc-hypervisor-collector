.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "SCC-HYPERVISOR-COLLECTOR" "1" "June 2022" "" "SCC Hypervisor Collector"
.hy
.SH NAME
.PP
\f[B]scc-hypervisor-collector\f[R] - Collect & Upload Hypervisor details
to SUSE Customer Center
.SH SYNOPSIS
.PP
\f[B]scc-hypervisor-collector [<optional>...]\f[R]
.SH DESCRIPTION
.PP
The \f[B]scc-hypervisor-collector(1)\f[R] collects details relevant to
subscription compliance tracking from customer hypervisor solutions and
uploads them to the SUSE Customer Center (SCC), using provided customer
credentials.
.SH COLLECTED DETAILS
.PP
For each hypervisor node that is managed by the specified hypervisors,
the following details are collected:
.TP
\f[B]Hypervisor Node Name\f[R]
The name assigned to the hypervisor node
.TP
\f[B]Hypervisor Node ID\f[R]
The id assigned to the hypervisor node
.TP
\f[B]Hypervisor Type\f[R]
The id assigned to the hypervisor node
.TP
\f[B]RAM\f[R]
Total system memory
.TP
\f[B]CPU Architecture\f[R]
The type of CPU, e.g.
\f[B]x86_64\f[R], \f[B]aarch64\f[R]
.TP
\f[B]CPU Topology\f[R]
The number of sockets, cores and threads
.TP
\f[B]Hosted VMs\f[R]
List of hosted VM with identification and state info.
.PP
For each hosted VM the following details are collected:
.TP
\f[B]Name\f[R]
The hypervisor configuration name for to the VM
.TP
\f[B]UUID\f[R]
The UUID associated with the VM if has been registered with the SCC.
In some cases (VMWare, see below) it may be a mangled form of the
origial UUID assigned by the hypervisor node.
.TP
\f[B]VMWare UUID\f[R] (VMWare Hypervisors only)
The UUID that VMWare assigned to the VM.
Depending on the VMWare hypervisor host software version, the VM BIOS
version used, and the Linux distribution/release being run, in some
cases the system UUID reported within the running instance may reverse
the byte order within each of the first 3 elements of the UUID.
.TP
\f[B]VM State\f[R]
The state of the VM, i.e.
running or stopped/shutoff.
.SS EXAMPLES OF COLLECTED DETAILS
.PP
The following examples are YAML representations of the details that are
collected from a QEMU/KVM Libvirt host and a VMWare vCenter:
.IP
.nf
\f[C]
- backend: libvirt0
  details:
    virtualization_hosts:
    - group_name: libvirt0
      identifier: 0dc1c04b-8b98-409c-9f73-45834fca4c73
      properties:
        arch: x86_64
        cores: 12
        name: libvirt0.example.com
        ram_mb: 262108
        sockets: 2
        threads: 24
        type: QEMU
      systems:
      - properties:
          vmState: x86_64
          vm_name: vm_libvirt0_0
        uuid: 17ada641-0840-4dec-8b7f-836f36639cef
      - properties:
          vmState: x86_64
          vm_name: vm_libvirt0_1
        uuid: c12f117e-f38a-4722-8e78-5d8524b239d2
      - properties:
          vmState: x86_64
          vm_name: vm_libvirt0_2
        uuid: 7ecf5159-7d7d-4e86-a8e9-b5916ad72a8e
      - properties:
          vmState: x86_64
          vm_name: vm_libvirt0_3
        uuid: 5a6ff93c-1ef7-49f6-99f0-22adc0b1588e
  valid: true

- backend: vcenter0
  details:
    virtualization_hosts:
    - group_name: vcenter0
      identifier: \[aq]\[aq]\[aq]vim.HostSystem:host-0\[aq]\[aq]\[aq]
      properties:
        arch: x86_64
        cores: 12
        name: esx0.vcenter0.example.com
        ram_mb: 262108
        sockets: 2
        threads: 24
        type: vmware
      systems:
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_0_0
          vmware_uuid: c675afea-75db-984b-82cf-fa57b384cfd9
        uuid: eaaf75c6-db75-4b98-82cf-fa57b384cfd9
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_0_1
          vmware_uuid: a932fe0e-5d69-e544-9706-d3db67f834fe
        uuid: 0efe32a9-695d-44e5-9706-d3db67f834fe
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_0_2
          vmware_uuid: 221e4ab5-1ab5-f248-bf2e-02c6266336e4
        uuid: b54a1e22-b51a-48f2-bf2e-02c6266336e4
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_0_3
          vmware_uuid: 26399028-5f3a-9f4c-803a-0353c99eb805
        uuid: 28903926-3a5f-4c9f-803a-0353c99eb805
    - group_name: vcenter0
      identifier: \[aq]\[aq]\[aq]vim.HostSystem:host-1\[aq]\[aq]\[aq]
      properties:
        arch: x86_64
        cores: 12
        name: esx1.vcenter0.example.com
        ram_mb: 262108
        sockets: 2
        threads: 24
        type: vmware
      systems:
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_1_0
          vmware_uuid: 1283147e-b217-1947-b35c-b5eb7676826b
        uuid: 7e148312-17b2-4719-b35c-b5eb7676826b
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_1_1
          vmware_uuid: ed340382-28a9-a449-85a0-df6ade7828d9
        uuid: 820334ed-a928-49a4-85a0-df6ade7828d9
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_1_2
          vmware_uuid: 4da580e7-fd16-6545-8409-ec1adbd03f26
        uuid: e780a54d-16fd-4565-8409-ec1adbd03f26
      - properties:
          vmState: x86_64
          vm_name: vm_vcenter0_1_3
          vmware_uuid: 5ccd2fd8-933f-4945-80a5-aaec26f6300a
        uuid: d82fcd5c-3f93-4549-80a5-aaec26f6300a
  valid: true
\f[R]
.fi
.SH OPTIONS
.TP
\f[B]-c\f[R], \f[B]--config\f[R] \f[B]<CONFIG_FILE>\f[R]
Specifies a file containing YAML configuration settings.
If both \f[B]--config\f[R] and \f[B]-config-dir\f[R] options are
specified, the specified \f[B]--config\f[R] file contents will be merged
over the settings loaded from the \f[B]-config-dir\f[R] directory,
superceding any existing settings.
.TP
\f[B]--config-dir\f[R], \f[B]--config_dir\f[R] \f[B]<CONFIG_DIR>\f[R]
Specifies a directory containing one of more YAML configuration files,
with \f[B].yaml\f[R] or \f[B].yml\f[R] suffixes that will be merged
together, in lexical sort order, to construct the configuration
settings.
Note that sub-directories will not be traversed.
Defaults to \f[B]\[ti]/.config/scc-hypervisor-collector\f[R].
.TP
\f[B]-C\f[R], \f[B]--check\f[R]
Checks the specified configuration settings for correctness, reporting
any issues found.
.TP
\f[B]--scc-credentials-check\f[R]
Validate that the supplied SCC credentials can be used to successfully
connect to the SUSE Customer Center.
.TP
\f[B]-h\f[R], \f[B]--help\f[R]
Provides basic details about the available command line options.
.TP
\f[B]-q\f[R], \f[B]--quiet\f[R]
Runs in quiet mode, only reporting errors.
.TP
\f[B]-v\f[R], \f[B]--verbose\f[R]
Runs in verbose mode, reporting additional details.
.TP
\f[B]-V\f[R], \f[B]--version\f[R]
Reports the version of \f[B]scc-hypervisor-collector\f[R].
.TP
\f[B]-L\f[R], \f[B]--logfile\f[R] \f[B]<LOG_FILE>\f[R]
Specifies the path to the log file in which to write log messages.
Defaults to \f[B]\[ti]/scc-hypervisor-collector.log\f[R].
.TP
\f[B]-r\f[R], \f[B]--retry-on-rate-limit\f[R], \f[B]--retry_on_rate_limit\f[R]
Enable retrying of data upload to the SCC if rate limiting is
encountered.
.TP
\f[B]-u\f[R], \f[B]--upload\f[R]
Upload the data collected to the SCC.
.TP
\f[B]-o\f[R], \f[B]--output\f[R] \f[B]OUTPUT\f[R]
Store collected data in specified file rather than uploading it.
Mutually exclusive with \f[B]--input\f[R].
.TP
\f[B]-i\f[R], \f[B]--input\f[R] \f[B]INPUT\f[R]
Load collected data from specified file rather than retrieving from
hypervisors that may be configured.
Mutually exclusive with \f[B]--output\f[R].
.SH SECURITY CONSIDERATIONS
.PP
The \f[B]scc-hypervisor-collector(1)\f[R] is intended to be run from a
restricted service account with no special privileges, and will exit
immediately if it detects that it is running with superuser privileges.
.SS HYPERVISOR ACCESS CREDENTIALS
.PP
Any hypervisor access credentials that are provided for use with the
\f[B]scc-hypervisor-collector(1)\f[R] should have minimal privileges
sufficent to allow retrieving the required details about the hypervisor
nodes and then VMs running on them.
.SS CONFIGURATION SETTINGS & LOG FILE PERMISSIONS
.PP
As the \f[B]scc-hypervisor-collector(5)\f[R] configuration settings will
contain sensitive information such as passwords, the command requires
that all specified configuration files and directories must be owned by
the non-root user that is running the command, with restrictive
permissions allowing only that user to access those files.
.PP
Similarly, while every effort has been taken to ensure that no sensitive
data is being written to the log files, to limit potential exposure of
such information the log files must also be owned by, and only
accessible by, the user that is running the
\f[B]scc-hypervisor-collector(5)\f[R] command.
.SS TLS/SSL CERTIFICATES
.PP
The \f[B]virtual-host-gatherer(1)\f[R] framework only supports certs
that are registered with the system certificate stores.
See \f[B]update-ca-certificates(8)\f[R] for details.
.SS SSH KEYS
.PP
For any \f[B]Libvirt\f[R] hypervisors that are specified with a
\f[B]qemu+ssh\f[R] type URI, appropriate SSH keys that support
passwordless SSH access to the target hypervisor node, must be available
in the \f[B]\[ti]/.ssh/\f[R] directory.
.PP
See \f[B]ssh-keygen(1)\f[R] for more details on how to generate
appropriate SSH keys if needed, and \f[B]ssh(1)\f[R] for the appropriate
permissions for the \f[B]\[ti]/.ssh/\f[R] directory and any keys stored
there.
.SS INPUT & OUTPUT FILES
.PP
The input files, like the configuration settings, must be owned by the
non-root user, with permissions that permit only that user to access it,
that is running the command.
Similarly, the output file will be created with the same restrictive
permissions and ownership.
.SS COLLECT ON ONE SYSTEM, UPLOAD ON ANOTHER
.PP
Collecting the hypervisor details and uploading them to the SCC in a
single command run may not always be possible.
For example, in some customer environments, systems with the necessary
access to collect hypervisor details may not have the internet access
required to upload the collected details to the SCC.
.PP
The \f[B]--input\f[R] and \f[B]--output\f[R] options are intended to
support such deployment models, as follows:
.IP \[bu] 2
on an internal system, with access to the hypervisors, the
\f[B]scc-hypervisor-collector\f[R] can be run using the
\f[B]--output\f[R] option to create a hypervisor details file.
.IP \[bu] 2
the hypervisor details file can be copied to a system with internet
access, which just needs the SCC credentials to be configured, where the
\f[B]scc-hypervisor-collector\f[R] can be run, using the \f[B]input\f[R]
option to specify the hypervisor details file, to upload the hypervisor
details to the SCC.
.SH CONFIGURATION SETTINGS
.PP
Configuration settings are specified in YAML format and must contain:
.TP
\f[B]backends\f[R]
a list of hypervisor backends from which to retrieve relevant details.
NOTE: Not required with \f[B]--input\f[R] is specified.
.TP
\f[B]credentials\f[R]
a collection of credentials that will be used to upload the collected
details to the SUSE Customer Center.
.PP
See \f[B]scc-hypervisor-collector(5)\f[R] for details about the possible
configuration settings.
.SS CONFIGURATION MANAGEMENT
.PP
The configuration settings, which must be in YAML format, can be
specified as:
.IP \[bu] 2
a single config file via the \f[B]--config\f[R] option.
.IP \[bu] 2
a directory containing a set of YAML files (with \f[B].yaml\f[R] or
\f[B].yml\f[R] suffixes) via the \f[B]-config-dir\f[R] option.
.PP
If a configuration directory is specified then any YAML files found
under that directory, not traversing sub-directories, with
\f[B].yaml\f[R] or \f[B].yml\f[R] suffixes, will be processed in lexical
sort order, merging their contents together.
.PP
If a configuration file was specified, it\[aq]s contents will be
processed last and merged over any existing configuration settings.
.PP
This scheme allows for configuration settings to be split up into
multiple files, e.g.
credentials can be specified in one file, and the hypervisor backends in
one or more files.
Additionally specific config settings can be overriden by an explicitly
specified config file.
.PP
When splitting the hypervisor backend details among multiple files, the
\f[B]backends\f[R] lists in each file will be merged together to form a
single combined list; exact duplicates will be ignored but partial
duplicates will result in errors.
.SS ACCESS AND OWNERSHIP
.PP
For security reasons only the non-root user that is running the
\f[B]scc-hypervisor-collector\f[R] command should be able to access the
specified configuration files.
.SS CONFIGURATION VALIDATION
.PP
The \f[B]--check\f[R] option can be utilised to check if the specified
configuration settings are valid, or will report any errors that it
detected.
.SS SUPPORTED HYPERVISORS
.PP
The following hypervisor types are supported:
.IP \[bu] 2
VMWare vCenter (type \f[B]VMware\f[R])
.IP \[bu] 2
Libvirt (type \f[B]Libvirt\f[R])
.PP
Each hypervisor type has specific configuration settings that must be
provided to permit the relevant details to be retrieved; these settings
are documented in \f[B]scc-hypervisor-collector(5)\f[R].
.SH EXIT CODES
.PP
\f[B]scc-hypervisor-collector\f[R] sets the following exit codes:
.TP
\f[B]0\f[R]
Run completed successfully, or configuration settings are valid if check
mode (\f[B]--check\f[R]) was specified.
.TP
\f[B]1\f[R]
An error occurred.
.SH IMPLEMENTATION
.PP
\f[B]scc-hypervisor-collector(1)\f[R] is implemented in Python.
It communicates with the SUSE Customer Center via a RESTful JSON API
over HTTP using TLS encryption.
.SS HYPERVISOR DETAILS RETRIEVAL
.PP
The \f[B]gatherer\f[R] Python module provided by the
\f[B]virtual-host-gatherer(1)\f[R] command is used to retrieve the
details from the configured hypervisors.
.SH ENVIRONMENT
.PP
\f[B]scc-hypervisor-collector(1)\f[R] respects the HTTP_PROXY
environment variable.
See https://www.suse.com/support/kb/doc/?id=000017441 for more details
on how to manually configure proxy usage.
.SH FILES AND DIRECTORIES
.TP
\f[B]\[ti]/.config/scc-hypervisor-collector/\f[R]
Default configuration directory containing YAML configuration files,
merged together in lexical sort order.
Directory and files must be owned by, and only accessible by, the user
running the \f[B]scc-hypervisor-collector(5)\f[R] command.
.TP
\f[B]\[ti]/scc-hypervisor-collector.log\f[R]
Default log file which will be automatically rotated and compressed if
it gets too large.
Log files must be owned by, and only accessible by, the user running the
\f[B]scc-hypervisor-collector(5)\f[R] command.
Will be created with appropriate permissions if no log file exists.
.TP
\f[B]\[ti]/.ssh/\f[R] (optional)
Directory holding any SSH keys (\f[B]ssh-keygen\f[R]) needed to access
\f[B]Libvirt\f[R] with \f[B]qemu+ssh\f[R] URIs.
.SH AUTHORS
.PP
Originally developed by Fergal Mc Carthy (fmccarthy\[at]suse.com) and
Meera Belur (mbelur\[at]suse.com) for the SCC at SUSE LLC
(scc-feedback\[at]suse.de)
.SH LINKS
.PP
SUSE Customer Center: https://scc.suse.com
.PP
scc-hypervisor-collector on GitHub:
https://github.com/SUSE/scc-hypervisor-collector
.PP
virtual-host-gatherer on GitHub:
https://github.com/uyuni-project/virtual-host-gatherer
.PP
YAML Specification: https://yaml.org/
.SH SEE ALSO
.PP
\f[B]scc-hypervisor-collector(5)\f[R],
\f[B]scc-hypervisor-collector.service(8)\f[R],
\f[B]scc-hypervisor-collector.timer(8)\f[R],
\f[B]virtual-host-gatherer(1)\f[R], \f[B]update-ca-certificates(8)\f[R],
\f[B]systemd(1)\f[R].
